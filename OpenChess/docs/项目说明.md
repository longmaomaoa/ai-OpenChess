# 中国象棋智能对弈助手项目说明

## 项目概述

这是一个基于计算机视觉和AI技术的中国象棋智能对弈助手，能够自动识别屏幕上的中国象棋界面，实时监控对手行动，提供走法建议和胜率分析。项目将屏幕上方定义为"对手"，下方定义为"玩家"，为玩家提供智能决策支持。该项目使用Python开发，结合了多种图像处理、OCR技术和象棋AI算法。

## 技术架构

### 核心技术栈
- **Python 3.7+** - 主要编程语言
- **OpenCV** - 计算机视觉库，用于图像处理和模板匹配
- **PyAutoGUI** - 屏幕截图和自动化控制
- **Pytesseract** - OCR文字识别
- **Tesseract OCR** - 开源OCR引擎
- **NumPy** - 数值计算
- **PIL/Pillow** - 图像处理
- **Tkinter** - GUI界面（可选）
- **象棋AI引擎** - 走法生成和局面评估

### 技术特点
1. **多模态识别**：结合模板匹配、OCR识别和颜色检测
2. **智能分析**：实时监控对手走法，提供AI决策建议
3. **胜率计算**：基于局面评估实时计算胜率百分比
4. **走法推荐**：生成最佳走法建议和候选方案
5. **自适应校准**：支持棋盘位置手动校准
6. **模板学习**：支持自定义棋子模板创建
7. **双界面模式**：命令行和GUI两种使用方式

## 文件结构

```
中国象棋智能助手/
├── chinese_chess_scanner.py      # 基础版本（命令行）
├── advanced_chess_scanner.py     # 高级版本（命令行）
├── gui_chess_scanner.py          # GUI版本
├── chess_ai_assistant.py         # AI助手核心模块
├── move_detector.py              # 走法检测器
├── position_evaluator.py         # 局面评估器
├── test_chess_ai.py              # AI功能测试
├── install_requirements.py       # 安装脚本
├── run_chess_scanner.bat         # Windows启动脚本
├── requirements.txt              # 依赖包列表
├── config.py                     # 配置文件
├── README.md                     # 说明文档
├── 项目说明.md                   # 项目详细说明
├── templates/                    # 棋子模板目录
├── chess_templates/              # 高级模板目录
└── tests/                        # 测试文件目录
```

## 功能特性

### 1. 棋盘检测
- 自动检测棋盘位置和边界
- 支持多种检测算法（边缘检测、霍夫变换、轮廓检测）
- 手动校准功能

### 2. 棋子识别
- **模板匹配**：使用预定义模板进行精确匹配
- **OCR识别**：识别棋子上的中文字符
- **颜色检测**：基于HSV颜色空间识别红黑棋子
- **综合判断**：多算法融合提高识别准确性

### 3. AI智能分析
- **走法检测**：自动识别对手的每一步行动
- **局面评估**：基于多维度因素评估当前局面
- **走法生成**：生成所有可能的合法走法
- **最佳推荐**：通过AI算法推荐最优走法

### 4. 胜率计算系统
- **实时胜率**：动态计算当前胜率百分比
- **趋势分析**：显示胜率变化趋势
- **威胁检测**：识别潜在威胁和机会
- **置信度评估**：提供推荐的可信度指标

### 5. 用户界面
- **命令行界面**：轻量级，适合自动化
- **图形界面**：可视化棋盘显示，操作友好
- **AI助手面板**：显示走法推荐和胜率信息
- **实时反馈**：状态信息和日志记录

## 安装指南

### 系统要求
- Windows 10/11
- Python 3.7或更高版本
- 至少4GB内存
- 支持屏幕截图

### 安装步骤

1. **安装Python**
   ```bash
   # 下载并安装Python 3.7+
   # 确保勾选"Add Python to PATH"
   ```

2. **运行安装脚本**
   ```bash
   python install_requirements.py
   ```

3. **安装Tesseract OCR**
   - Windows: 下载安装包并添加到PATH
   - 确保安装中文语言包

4. **验证安装**
   ```bash
   python -c "import cv2, pyautogui, pytesseract; print('安装成功')"
   ```

## 使用方法

### 快速开始

1. **运行程序**
   ```bash
   # 命令行版本
   python chinese_chess_scanner.py
   
   # GUI版本
   python gui_chess_scanner.py
   
   # Windows用户可直接双击
   run_chess_scanner.bat
   ```

2. **校准棋盘**
   - 选择"校准棋盘位置"
   - 按提示点击棋盘左上角和右下角
   - 确认校准完成

3. **开始AI助手**
   - 选择"智能分析"或"持续监控"
   - 实时观察对手走法，给出最佳应对方案
   - 显示胜率变化和局面评估

### 高级功能

#### 创建棋子模板
1. 选择"创建模板"
2. 输入棋子名称（如：red_king）
3. 将鼠标移动到对应棋子
4. 按回车确认截图

#### 调整识别参数
- 修改`config.py`中的配置参数
- 调整颜色范围、置信度阈值等
- 重启程序生效

## 技术原理

### 1. 图像预处理
```python
# 灰度转换
gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)

# 边缘检测
edges = cv2.Canny(gray, 50, 150)

# 二值化
_, binary = cv2.threshold(gray, 0, 255, cv2.THRESH_BINARY + cv2.THRESH_OTSU)
```

### 2. 模板匹配
```python
# 使用OpenCV的matchTemplate函数
result = cv2.matchTemplate(image, template, cv2.TM_CCOEFF_NORMED)
confidence = np.max(result)
```

### 3. OCR识别
```python
# 使用Tesseract进行中文识别
text = pytesseract.image_to_string(image, lang='chi_sim', config='--psm 7')
```

### 4. 颜色检测
```python
# HSV颜色空间检测
hsv = cv2.cvtColor(image, cv2.COLOR_BGR2HSV)
mask = cv2.inRange(hsv, lower_bound, upper_bound)
```

## 性能优化

### 1. 扫描优化
- 区域限制扫描
- 增量更新检测
- 多线程处理

### 2. 识别优化
- 模板缓存
- 置信度过滤
- 结果验证

### 3. 内存优化
- 图像压缩
- 及时释放资源
- 批量处理

## 故障排除

### 常见问题

1. **识别不准确**
   - 检查棋盘校准
   - 创建棋子模板
   - 调整屏幕亮度

2. **程序无法启动**
   - 检查Python版本
   - 验证依赖包安装
   - 确认Tesseract配置

3. **性能问题**
   - 降低扫描频率
   - 缩小扫描区域
   - 关闭其他程序

### 调试模式
```python
# 启用详细日志
import logging
logging.basicConfig(level=logging.DEBUG)

# 保存调试图像
cv2.imwrite('debug_image.png', image)
```

## 扩展功能

### 可能的改进方向

1. **AI增强**
   - 深度学习模型
   - 卷积神经网络
   - 迁移学习

2. **游戏分析**
   - 走法记录
   - 局势分析
   - 建议提示

3. **多平台支持**
   - 移动端适配
   - 云端处理
   - 跨平台兼容

4. **用户体验**
   - 语音提示
   - 手势控制
   - 智能校准

## 开发指南

### 代码结构
- 模块化设计
- 面向对象编程
- 异常处理机制

### 测试方法
```python
# 单元测试
python -m pytest tests/

# 集成测试
python test_integration.py

# 性能测试
python benchmark.py
```

### 贡献指南
1. Fork项目
2. 创建功能分支
3. 提交代码
4. 发起Pull Request

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交Issue
- 发送邮件
- 参与讨论

---

**注意**：本项目仅供学习和研究使用，请遵守相关法律法规。
